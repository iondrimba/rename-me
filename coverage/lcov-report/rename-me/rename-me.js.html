<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for rename-me\rename-me.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">rename-me/</a> rename-me.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">84.21% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>64/76</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">50% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>1/2</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>15/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">84.21% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>64/76</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span></td><td class="text"><pre class="prettyprint lang-js">'use-strict';
//node &gt;  rename-me file version outputpath index.html
//demo &gt; node rename-me src/app.js 1.1.1 public/js public/index.html
//output &gt; public/app.1.1.1.js
var fs = require('fs'); 
&nbsp;
var renameMe = function(options) {
    
    this.filePaths = options.filePath;
    this.version = options.version;
    this.outputfolder = options.outputfolder;
    this.indexFile = options.indexFile;
&nbsp;
    this.fileNames = [];
    this.fileExtensions = [];
    this.tempNameNoExtension = [];
    this.filesRenamed = [];
    this.finalOutputPaths = [];    
&nbsp;
    try {
        setup();
        rename(this.filePaths, this.finalOutputPaths);
        replaceReferences(this.fileNames,this.filesRenamed, this.indexFile);
    } catch (ex) {
<span class="cstat-no" title="statement not covered" >        console.log('ex:', ex.message);</span>
    }
&nbsp;
    function setup() {
        this.fileNames = removePathFromFileName(this.filePaths);
        this.fileExtensions = getFileExtension(this.fileNames);
        this.tempNameNoExtension = getFileNameWithoutExtension(this.fileNames);
&nbsp;
        this.filesRenamed = concatNamedVersion({
            name: this.tempNameNoExtension,
            version: this.version,
            extension: this.fileExtensions
        });
&nbsp;
        this.outputfolder.forEach(function(folder, index) {
            this.finalOutputPaths.push(folder + this.filesRenamed[index]);
        }.bind(this));
    }
&nbsp;
    function rename(filePaths, finalOutputPaths) {
        //rename source files and move them to the destination folder
        filePaths.forEach(function(path, index) {
            var content = fs.readFileSync(path);                    
            fs.writeFileSync(finalOutputPaths[index], content);  
        }.bind(this));
    };
&nbsp;
    function removePathFromFileName(files) {
        var output = [];
        files.forEach(function(name) {
            var filename = name.replace(/.+([^\/])\//g, '');
            //src/js/hello.js -&gt; hello.js
            output.push(filename);
        });
        return output;
    };
&nbsp;
    function getFileExtension(files) {
        var output = [];
        files.forEach(function(name) {
            var filename = name.replace(/[0-9a-z-0-1]{1,}/, '');
&nbsp;
            //hello.js -&gt; .js
            output.push(filename);
        });
        return output;
    };
&nbsp;
    function getFileNameWithoutExtension(files) {
        var output = [];
        files.forEach(function(name) {
            var filename = name.replace(/[0-9a-z]+$/, '');
&nbsp;
            // hello.js -&gt; hello.
            output.push(filename);
        });
        return output;
    };
&nbsp;
    function replaceReferences(fileNames, newNames, indexFile) {
        var contents = fs.readFileSync(indexFile, 'utf8');
        var regex = new RegExp(fileNames, "g");                    
        //replace references inside the main file (index.html)
        console.log('ref', fileNames, newNames);
        fileNames.forEach(function(name, index) {
            var splited = name.split('.');
            var pattern = splited[0] + '[.0-9.]{1,}' + splited[1];
            var regex = new RegExp(pattern, "i");            
            contents = contents.replace(regex, newNames[index]);
            console.log(contents);            
        });        
        fs.writeFileSync(indexFile, contents, 'utf8');       
    };
&nbsp;
    function concatNamedVersion(options) {
        var output = [];
        options.name.forEach(function(name, index) {
            var filename = name.replace(/[0-9a-z]+$/, '');
&nbsp;
            // hello.js -&gt; hello.version.js (hello.1.2.0.js)
            output.push(options.name[index] + options.version + options.extension[index]);
        });
        return output;
    };
}
&nbsp;
//executed if called manually via terminal
<span class="missing-if-branch" title="if path not taken" >I</span>if (process.argv.length &gt; 3) {
&nbsp;
<span class="cstat-no" title="statement not covered" >    var fs = require('fs');</span>
<span class="cstat-no" title="statement not covered" >    var filePath = process.argv[2]; </span>//SOURCE FILE PATH ex: Desktop/excel.xlsx;
<span class="cstat-no" title="statement not covered" >    var version = process.argv[3]; </span>//OUTPUT PATH ex: 1.2.3 - could be anything'
<span class="cstat-no" title="statement not covered" >    var outputfolder = process.argv[4]; </span>//OUTPUT PATH ex: Desktop/'
<span class="cstat-no" title="statement not covered" >    var indexFile = process.argv[5]; </span>//INDEX FILE TO REPLACE REFERNCES OF OLD FILE'
&nbsp;
&nbsp;
<span class="cstat-no" title="statement not covered" >    var options = {};</span>
<span class="cstat-no" title="statement not covered" >    options.filePath = filePath.split(',');;</span>
<span class="cstat-no" title="statement not covered" >    options.version = version;</span>
<span class="cstat-no" title="statement not covered" >    options.outputfolder = outputfolder.split(',');;</span>
<span class="cstat-no" title="statement not covered" >    options.indexFile = indexFile;</span>
<span class="cstat-no" title="statement not covered" >    renameMe(options);</span>
}
&nbsp;
module.exports = renameMe;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Mar 25 2016 18:15:41 GMT-0300 (Hora oficial do Brasil)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
